{% extends "base.twig" %}

{% block main %}
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

    <h1 class="title" id="contactFormTitle">
        {{ is_edit ? "Modifier l'article" : "Rédiger un article" }}
    </h1>

    <style>
        #articleFormContainer { max-width: 900px !important; }
        .editor-toolbar { background-color: #fff; color: #000; }
        [data-bs-theme="dark"] .CodeMirror, 
        [data-bs-theme="dark"] .editor-toolbar, 
        [data-bs-theme="dark"] .editor-preview-side {
            background-color: #2b3035; color: #ddd; border-color: #444;
        }
        [data-bs-theme="dark"] .editor-toolbar button { color: #ddd; }
        [data-bs-theme="dark"] .editor-toolbar button:hover { background-color: #444; }
    </style>

    {# L'action change selon le mode #}
    <form action="{{ is_edit ? '/traitementEdition' : '/traitementCreation' }}" 
          method="POST" id="contactForm" class="mx-auto" style="max-width: 800px;">
        
        {% if error %} <div class="alert alert-danger">{{ error }}</div> {% endif %}

        {# Champ caché ID (seulement en édition) #}
        {% if is_edit %}
            <input type="hidden" name="article_id" value="{{ article_id }}">
        {% endif %}

        <label for="titre">Titre :</label>
        <input type="text" id="titre" name="titre" value="{{ data.titre }}" required>

        <label for="statut">Statut :</label>
        <select name="statut" id="statut" class="form-select mb-3" style="background-color: var(--bg2); color: var(--font-color); border: none; padding: 10px; border-radius: 4px;">
            <option value="Brouillon" {{ data.statut == 'Brouillon' ? 'selected' : '' }}>Brouillon</option>
            
            {% if peutPublier %}
                <option value="Publié" {{ data.statut == 'Publié' ? 'selected' : '' }}>Publié</option>
                <option value="Archivé" {{ data.statut == 'Archivé' ? 'selected' : '' }}>Archivé</option>
            {% endif %}
        </select>

        <label for="contenu">Contenu :</label>
        <textarea id="contenu" name="contenu">{{ data.contenu }}</textarea>

		<div class="d-flex gap-3 mt-3">
            <button type="submit" class="btn btn-primary">
                {{ is_edit ? "Mettre à jour" : "Enregistrer" }}
            </button>

            <a href="/connexion" class="btn btn-secondary text-decoration-none text-white d-flex align-items-center">
                Annuler
            </a>
        </div>
    </form>

    <script>
        const easyMDE = new EasyMDE({ 
            element: document.getElementById('contenu'),
            spellChecker: false,
            minHeight: "300px",
            promptURLs: true
        });
    </script>
{% endblock %}